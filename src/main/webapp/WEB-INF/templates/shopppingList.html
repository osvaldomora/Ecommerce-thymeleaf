<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="favicon.ico">

<title>Eccomerce-Osvaldo</title>

<link th:href="@{/resources/bootstrap/css/bootstrap.min.css}"
	rel="stylesheet">

<link th:href="@{/resources/bootstrap/css/jumbotron.css}"
	rel="stylesheet">
<link th:href="@{/resources/bootstrap/css/sticky-footer-navbar.css}"
	rel="stylesheet">
</head>

<body>


	<main role="main">
		<!-- Main jumbotron for a primary marketing message or call to action th:object="${search}"  th:field="*{productCategory}"  -->
		<div class="jumbotron">
			<div class="container">
				<h3>search product.</h3>

				<form class="form-inline" th:action="@{/search}" method="get">
					<input type="text" class="form-control mb-3" name="productName"
						id="exampleFormControlInput1" placeholder="Search product">&nbsp;

					<button type="submit" class="btn btn-primary mb-3">search</button>
				</form>
			</div>
		</div>
		<hr>
		<hr>
		<div class="container">
			<!--               <a class="btn btn-primary" th:href="@{/logout}">Logout</a> -->

			<div class="card">
				<h4 class="card-header">
					<strong>shoppingList</strong>
				</h4>

				<div class="card-body">
					<form th:action="@{/getProducts}" method="get">
						
						<!-- <label >Order: </label> -->
						<table th:each="prod: ${productsList}" class="table table-striped table-bordered ">
							<tr>
								<th class="text-center" colspan="4" th:text="Order:  + ${prod[0].order}"></th>
							</tr>
							<tr>
								<th>Product Name</th>
								<th>Product Category</th>
								<th>Price</th>
								<th>Image</th>

							</tr>

							<tr th:each="prods: ${prod} ">

								<td th:text="${prods.productName}"></td>
								<td th:text="${prods.productCategory}"></td>
								<td class="price" th:text="${prods.productPrice}"></td>

								<td><img
									th:src="@{/resources/images/{img} ( img=${prods.imagen} )  }"
									width="136" height="136"></td>
							</tr>
							<tr>
						        <td/>
						        <td>Total: </td>
						        <td><b th:text="${prod[0].total}"></b></td>
						        <td/>
						    </tr>
							<!-- <tr th:each="prods: ${prod}">
								<td></td>
								<td>Total: </td>
								<td th:text="${prods.total}"></td>
								<td></td>
							</tr> -->
						</table>
						
						<div class="float-end">
							<input type="number" id="total_input" readonly>
						</div>
						
						<button type="submit" title="View Cart." class="btn btn-primary">Products View
						</button>
						
					</form>

				</div>
			</div>
		</div>

	</main>


	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
	<script th:src="@{/resources/bootstrap/js/bootstrap.min.js}"></script>
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
	<script>
		$(function () {
			let sum = 0;
		    console.log("javascript loaded");
		    //var sum = 0;
		    
			$(".price").each(function() {
			    var value = $(this).text();
			    // add only if the value is number
			    if(!isNaN(value) && value.length != 0) {
			    	sum += parseFloat(value);
		    	}
			});
			$("#total_input").val(sum);
			
			console.log(sum);
		    /* $("#table_routes tr").click(function(){
		 	    let result = '';
		 	   	$(this).find('input[type=hidden]').each(function(){
		 		    result += $(this).attr('name')+'='+$(this).val()+'&'
		 		})
		 		console.log(result);
			    $.post('rides', result, function(responseText) {
					console.log(responseText)
				});
		 	   	$.ajax({
		 	        type: "POST",
		 	        url: "/rides",
		 	        data: result,
		 	        success: function (data){
		 	          console.log(data)
		 	        },
		 	        error: function (data) {
		 	          console.log('Error:', data);
		 	        }
		 	    });
		   	}); */
		});
	</script>
</body>
</html>